var st=s=>{throw TypeError(s)};var q=(s,t,e)=>t.has(s)||st("Cannot "+e);var i=(s,t,e)=>(q(s,t,"read from private field"),e?e.call(s):t.get(s)),p=(s,t,e)=>t.has(s)?st("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),a=(s,t,e,r)=>(q(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e),l=(s,t,e)=>(q(s,t,"access private method"),e);import{S as ft,s as V,n as pt,i as it,d as rt,t as yt,e as bt,g as Rt,h as nt,k as ut,r as C,u as gt}from"./index-BxpujTYj.js";var y,h,w,f,S,T,v,A,x,D,Q,U,E,F,n,M,W,_,z,N,H,G,J,ct,ot,vt=(ot=class extends ft{constructor(t,e){super();p(this,n);p(this,y);p(this,h);p(this,w);p(this,f);p(this,S);p(this,T);p(this,v);p(this,A);p(this,x);p(this,D);p(this,Q);p(this,U);p(this,E);p(this,F);a(this,h,void 0),a(this,w,void 0),a(this,f,void 0),a(this,F,new Set),a(this,y,t),this.options=e,a(this,v,null),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,h).addObserver(this),at(i(this,h),this.options)&&l(this,n,M).call(this),l(this,n,N).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return X(i(this,h),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return X(i(this,h),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,l(this,n,H).call(this),l(this,n,G).call(this),i(this,h).removeObserver(this)}setOptions(t,e){const r=this.options,b=i(this,h);if(this.options=i(this,y).defaultQueryOptions(t),V(r,this.options)||i(this,y).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,h),observer:this}),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),l(this,n,J).call(this);const o=this.hasListeners();o&&ht(i(this,h),b,this.options,r)&&l(this,n,M).call(this),this.updateResult(e),o&&(i(this,h)!==b||this.options.enabled!==r.enabled||this.options.staleTime!==r.staleTime)&&l(this,n,W).call(this);const u=l(this,n,_).call(this);o&&(i(this,h)!==b||this.options.enabled!==r.enabled||u!==i(this,E))&&l(this,n,z).call(this,u)}getOptimisticResult(t){const e=i(this,y).getQueryCache().build(i(this,y),t),r=this.createResult(e,t);return Ct(this,r)&&(a(this,f,r),a(this,T,this.options),a(this,S,i(this,h).state)),r}getCurrentResult(){return i(this,f)}trackResult(t){const e={};return Object.keys(t).forEach(r=>{Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:()=>(i(this,F).add(r),t[r])})}),e}getCurrentQuery(){return i(this,h)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=i(this,y).defaultQueryOptions(t),r=i(this,y).getQueryCache().build(i(this,y),e);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,e))}fetch(t){return l(this,n,M).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,f)))}createResult(t,e){var et;const r=i(this,h),b=this.options,o=i(this,f),u=i(this,S),d=i(this,T),I=t!==r?t.state:i(this,w),{state:c}=t;let{error:L,errorUpdatedAt:Z,fetchStatus:P,status:O}=c,$=!1,g;if(e._optimisticResults){const R=this.hasListeners(),K=!R&&at(t,e),dt=R&&ht(t,r,e,b);(K||dt)&&(P=Rt(t.options.networkMode)?"fetching":"paused",c.dataUpdatedAt||(O="pending")),e._optimisticResults==="isRestoring"&&(P="idle")}if(e.select&&typeof c.data<"u")if(o&&c.data===(u==null?void 0:u.data)&&e.select===i(this,A))g=i(this,x);else try{a(this,A,e.select),g=e.select(c.data),g=nt(o==null?void 0:o.data,g,e),a(this,x,g),a(this,v,null)}catch(R){a(this,v,R)}else g=c.data;if(typeof e.placeholderData<"u"&&typeof g>"u"&&O==="pending"){let R;if(o!=null&&o.isPlaceholderData&&e.placeholderData===(d==null?void 0:d.placeholderData))R=o.data;else if(R=typeof e.placeholderData=="function"?e.placeholderData((et=i(this,D))==null?void 0:et.state.data,i(this,D)):e.placeholderData,e.select&&typeof R<"u")try{R=e.select(R),a(this,v,null)}catch(K){a(this,v,K)}typeof R<"u"&&(O="success",g=nt(o==null?void 0:o.data,R,e),$=!0)}i(this,v)&&(L=i(this,v),g=i(this,x),Z=Date.now(),O="error");const k=P==="fetching",B=O==="pending",j=O==="error",tt=B&&k;return{status:O,fetchStatus:P,isPending:B,isSuccess:O==="success",isError:j,isInitialLoading:tt,isLoading:tt,data:g,dataUpdatedAt:c.dataUpdatedAt,error:L,errorUpdatedAt:Z,failureCount:c.fetchFailureCount,failureReason:c.fetchFailureReason,errorUpdateCount:c.errorUpdateCount,isFetched:c.dataUpdateCount>0||c.errorUpdateCount>0,isFetchedAfterMount:c.dataUpdateCount>I.dataUpdateCount||c.errorUpdateCount>I.errorUpdateCount,isFetching:k,isRefetching:k&&!B,isLoadingError:j&&c.dataUpdatedAt===0,isPaused:P==="paused",isPlaceholderData:$,isRefetchError:j&&c.dataUpdatedAt!==0,isStale:Y(t,e),refetch:this.refetch}}updateResult(t){const e=i(this,f),r=this.createResult(i(this,h),this.options);if(a(this,S,i(this,h).state),a(this,T,this.options),V(r,e))return;i(this,S).data!==void 0&&a(this,D,i(this,h)),a(this,f,r);const b={},o=()=>{if(!e)return!0;const{notifyOnChangeProps:u}=this.options,d=typeof u=="function"?u():u;if(d==="all"||!d&&!i(this,F).size)return!0;const m=new Set(d??i(this,F));return this.options.throwOnError&&m.add("error"),Object.keys(i(this,f)).some(I=>{const c=I;return i(this,f)[c]!==e[c]&&m.has(c)})};(t==null?void 0:t.listeners)!==!1&&o()&&(b.listeners=!0),l(this,n,ct).call(this,{...b,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&l(this,n,N).call(this)}},y=new WeakMap,h=new WeakMap,w=new WeakMap,f=new WeakMap,S=new WeakMap,T=new WeakMap,v=new WeakMap,A=new WeakMap,x=new WeakMap,D=new WeakMap,Q=new WeakMap,U=new WeakMap,E=new WeakMap,F=new WeakMap,n=new WeakSet,M=function(t){l(this,n,J).call(this);let e=i(this,h).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(pt)),e},W=function(){if(l(this,n,H).call(this),it||i(this,f).isStale||!rt(this.options.staleTime))return;const e=yt(i(this,f).dataUpdatedAt,this.options.staleTime)+1;a(this,Q,setTimeout(()=>{i(this,f).isStale||this.updateResult()},e))},_=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,f).data,i(this,h)):this.options.refetchInterval)??!1},z=function(t){l(this,n,G).call(this),a(this,E,t),!(it||this.options.enabled===!1||!rt(i(this,E))||i(this,E)===0)&&a(this,U,setInterval(()=>{(this.options.refetchIntervalInBackground||bt.isFocused())&&l(this,n,M).call(this)},i(this,E)))},N=function(){l(this,n,W).call(this),l(this,n,z).call(this,l(this,n,_).call(this))},H=function(){i(this,Q)&&(clearTimeout(i(this,Q)),a(this,Q,void 0))},G=function(){i(this,U)&&(clearInterval(i(this,U)),a(this,U,void 0))},J=function(){const t=i(this,y).getQueryCache().build(i(this,y),this.options);if(t===i(this,h))return;const e=i(this,h);a(this,h,t),a(this,w,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},ct=function(t){ut.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(i(this,f))}),i(this,y).getQueryCache().notify({query:i(this,h),type:"observerResultsUpdated"})})},ot);function mt(s,t){return t.enabled!==!1&&!s.state.dataUpdatedAt&&!(s.state.status==="error"&&t.retryOnMount===!1)}function at(s,t){return mt(s,t)||s.state.dataUpdatedAt>0&&X(s,t,t.refetchOnMount)}function X(s,t,e){if(t.enabled!==!1){const r=typeof e=="function"?e(s):e;return r==="always"||r!==!1&&Y(s,t)}return!1}function ht(s,t,e,r){return e.enabled!==!1&&(s!==t||r.enabled===!1)&&(!e.suspense||s.state.status!=="error")&&Y(s,e)}function Y(s,t){return s.isStaleByTime(t.staleTime)}function Ct(s,t){return!V(s.getCurrentResult(),t)}var lt=C.createContext(!1),Ot=()=>C.useContext(lt);lt.Provider;function Et(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}var St=C.createContext(Et()),Qt=()=>C.useContext(St);function Ut(s,t){return typeof s=="function"?s(...t):!!s}var Ft=(s,t)=>{(s.suspense||s.throwOnError)&&(t.isReset()||(s.retryOnMount=!1))},It=s=>{C.useEffect(()=>{s.clearReset()},[s])},wt=({result:s,errorResetBoundary:t,throwOnError:e,query:r})=>s.isError&&!t.isReset()&&!s.isFetching&&Ut(e,[s.error,r]),Tt=s=>{s.suspense&&typeof s.staleTime!="number"&&(s.staleTime=1e3)},xt=(s,t)=>s.isLoading&&s.isFetching&&!t,Dt=(s,t,e)=>(s==null?void 0:s.suspense)&&xt(t,e),Pt=(s,t,e)=>t.fetchOptimistic(s).catch(()=>{e.clearReset()});function Mt(s,t,e){const r=gt(),b=Ot(),o=Qt(),u=r.defaultQueryOptions(s);u._optimisticResults=b?"isRestoring":"optimistic",Tt(u),Ft(u,o),It(o);const[d]=C.useState(()=>new t(r,u)),m=d.getOptimisticResult(u);if(C.useSyncExternalStore(C.useCallback(I=>{const c=b?()=>{}:d.subscribe(ut.batchCalls(I));return d.updateResult(),c},[d,b]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),C.useEffect(()=>{d.setOptions(u,{listeners:!1})},[u,d]),Dt(u,m,b))throw Pt(u,d,o);if(wt({result:m,errorResetBoundary:o,throwOnError:u.throwOnError,query:d.getCurrentQuery()}))throw m.error;return u.notifyOnChangeProps?m:d.trackResult(m)}function Bt(s,t){return Mt(s,vt)}export{Ut as s,Bt as u};
